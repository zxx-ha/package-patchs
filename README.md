# PMSG Parser Script

## Description

This script parses Android `pmsg` (Persistent Message Store) log files. It is designed to interpret `pmsg` entries that follow a common structure used by Android userspace loggers (similar to what `logcat` might store or read). The script outputs the parsed log entries in a human-readable format, mimicking the `logcat -L` (brief) style.

## Usage

```
python parse_pmsg.py [options] <pmsg_file_path>
```

## Options

*   `<pmsg_file_path>`: Path to the `pmsg` log file that needs to be parsed. This is a required argument.
*   `-v`, `--verbose`: Enable verbose output. When this flag is set, the script prints detailed parsing information, warnings, and errors to `stderr`. This is useful for debugging the parsing process or understanding issues with a `pmsg` file.

## Output Format

The script outputs parsed log entries to `stdout` in a format similar to `logcat -L` (brief):

```
MM-DD HH:MM:SS.mmm  PID  TID LEVEL TAG: Message
```

Where:
*   `MM-DD HH:MM:SS.mmm`: Timestamp of the log entry (Month-Day Hour:Minute:Second.Millisecond).
*   `PID`: Process ID of the logging application (right-justified, 5 characters).
*   `TID`: Thread ID of the logging thread (right-justified, 5 characters).
*   `LEVEL`: Log level character (e.g., `V`erbose, `D`ebug, `I`nfo, `W`arn, `E`rror, `F`atal).
*   `TAG`: Log tag associated with the entry.
*   `Message`: The actual log message content.

Example:
```
01-23 10:30:55.123   1234   5678 D MyTag: This is a sample log message.
```

## Assumptions and Limitations

*   **Log Entry Structure**: The script assumes a specific binary structure for log entries, which is common for Android userspace loggers. This structure is detailed in the inline comments within `parse_pmsg.py`. Briefly, it expects a fixed-size header (typically 20 bytes) containing `entry_len`, `header_size_or_version`, `pid`, `tid`, `sec`, and `nsec`, followed by a payload containing `prio` (priority), a null-terminated `tag`, and a null-terminated `message`.
*   **File Type Compatibility**: This parser is specifically designed for `pmsg` files generated by Android userspace loggers. It may **not** correctly parse all types of `pmsg` files. For instance:
    *   Kernel `pmsg` entries often have a different structure (e.g., using `printk` format) and will likely not be parsed correctly.
    *   `pmsg` files from different Android versions or custom ROMs might have variations in their log entry structure that could lead to parsing errors or incorrect output.
*   **Accuracy**: The accuracy of the parsed output is highly dependent on the `pmsg` file adhering to the assumed log entry structure. If the structure differs, the script may fail, produce partial results, or misinterpret data.
*   **Error Handling**: While the script includes error handling for some common issues (e.g., malformed entries, incomplete data), it might not gracefully handle every possible variation or corruption in `pmsg` files. Verbose mode can help diagnose issues.

## Testing

A test suite named `test_parse_pmsg.py` is provided to verify the core parsing logic of the script against the assumed log entry format. It uses the `unittest` module.

To run the tests:
```
python -m unittest test_parse_pmsg.py
```
This helps ensure the parser behaves as expected for valid and some common malformed entry types.
